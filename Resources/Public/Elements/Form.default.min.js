!function(n){function o(t){this.elements=[].slice.call(t).map(function(t){return new i(t)})}function i(t){return this.container=t||null,this.container&&this.container.id?(this.search=n.getElementById(this.container.id+"-search"),this.latLon=n.getElementById(this.container.id+"-lat-lon"),this.search&&this.latLon?(this.position=n.getElementById(this.container.id+"-position"),this.submit=n.getElementById(this.container.id+"-submit"),this.initAutocomplete(),this.map=this.initMap(),void this.onInitialize()):null):null}i.prototype.initAutocomplete=function(){var e=this;if(this.search.hasAttribute("autocomplete")&&"off"===this.search.getAttribute("autocomplete"))return null;this.searchAutocomplete=new google.maps.places.Autocomplete(this.search,{language:"ru",componentRestrictions:{country:this.container.hasAttribute("data-restrict-countries")?String(this.container.getAttribute("data-restrict-countries")).split(",").map(function(t){return t.trim()}):[]}}),this.searchAutocomplete.addListener("place_changed",this.handle_autocompletePlaceChanged.bind(this)),function(t,e){for(;(t=t.parentElement)&&t.tagName!=e.toLowerCase()&&t.tagName!=e.toUpperCase(););return t}(this.search,"form").addEventListener("submit",function(t){t.currentTarget.classList.add("loading"),n.activeElement===e.search&&t.preventDefault()}),this.search.addEventListener("change",function(t){t.currentTarget.value||e.reset()})},i.defaultStyles=[{featureType:"poi",elementType:"labels.icon",stylers:[{color:"#9d9d9d"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#9d9d9d"}]}],i.prototype.initMap=function(){var t=n.getElementById(this.container.id+"-map");if(!t)return null;var e=this.container.hasAttribute("data-lat-lon")?this.container.attributes["data-lat-lon"].value.split(","):[];return new google.maps.Map(t,{zoom:10,center:{lat:Number(2===e.length?e[0]:t.attributes["data-latitude"].value),lng:Number(2===e.length?e[1]:t.attributes["data-longitude"].value)},streetViewControl:!1,rotateControl:!1,fullscreenControl:!1,zoomControl:!1,mapTypeControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},styles:window.googleMapStyles||i.defaultStyles})},i.prototype.onInitialize=function(){this.position&&this.position.parentNode.removeChild(this.position),this.container.classList.add("Geoselect--js"),(this.container.geoselect=this).container.dispatchEvent(new CustomEvent("geoselect_init"))},i.prototype.handle_autocompletePlaceChanged=function(t){var e=this.searchAutocomplete.getPlace();if(!e||!e.geometry)return this.container.removeAttribute("data-lat-lon"),null;var n=e.geometry.location.lat(),e=e.geometry.location.lng();this.container.setAttribute("data-lat-lon",n+","+e),this.setLatLon(n,e)},i.prototype.setLatLon=function(t,e){var n;this.latLon.value=t+","+e,this.map&&(this.marker?this.marker.setPosition({lat:t,lng:e}):(n=(n=this.map.getDiv().attributes["data-marker"])?n.value:null,this.marker=new google.maps.Marker({position:{lat:t,lng:e},map:this.map,icon:n?{url:n,size:new google.maps.Size(48,68),scaledSize:new google.maps.Size(32,45),anchor:new google.maps.Point(12,34)}:null})),this.map.setCenter({lat:t,lng:e}),this.map.setZoom(10)),this.container.dispatchEvent(new CustomEvent("geoselect_change",{detail:{latitude:t,longitude:e}}))},i.prototype.reset=function(){var t;this.marker&&(this.marker.setMap(null),this.marker=null,t=n.getElementById(this.container.id+"-map"),this.map.setCenter({lat:Number(t.attributes["data-latitude"].value),lng:Number(t.attributes["data-longitude"].value)})),this.map.setZoom(6),this.latLon.value&&(this.latLon.value=""),this.search.value&&(this.search.value=""),this.container.removeAttribute("data-lat-lon"),this.container.dispatchEvent(new CustomEvent("geoselect_change",{detail:{}}))},i.prototype.addMyLocationControl=function(){var e=this;if(!navigator.geolocation)return!1;var t=n.createElement("div");t.innerHTML=n.getElementById("GoogleMap-MyLocation").innerHTML,t.index=1,t.addEventListener("click",function(t){navigator.geolocation.getCurrentPosition(function(t){e.setLatLon(t.coords.latitude,t.coords.longitude),e.search.value=t.coords.latitude+","+t.coords.longitude,e.map.setZoom(14)})}),this.map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(t)},n.addEventListener("DOMContentLoaded",function(t){var e=n.querySelectorAll(".Geoselect");e.length&&new o(e)})}(document);